# 代码设计规范

> Programs must be written for people to read, and only incidentally for machines to execute.
>
> ― Harold Abelson, Structure and Interpretation of Computer Programs 

---

尽力写出易于理解的代码，把代码写得让别人能一目尽览而不必殚精竭虑地研究。易读的代码强于写更多的注释。

## 命名规范

有意义的命名，名副其实，言简意赅，可读性高。无论是`类名`、`变量名`、`函数名` 还是 `文件名`

### 缩写

减少不必要的缩写，除非是一些常用的缩写，比如`max`，`min`，`info`等等
- [x] 正确：bucketName
- [ ] ~~错误~~：bn, bname, bktName

### 区分

做有意义的区分。**==命名读得出来，单词可搜索==**
- [x] 正确：originSignature, calculatedSignature
- [ ] ~~错误~~：sign1, sign2, download1(), download()
 
### 缩略词

首字母缩略词在用驼峰的时候，也变成小写,
- [x] 正确：userId, getCpuInfo
- [ ] ~~错误~~：userID, getCPUInfo

### 词性

类名／变量是名词或名词短语; 方法名是动词或者动词短语

### 不重复使用 
避免将同一单词用于不同目的
- [ ] ~~错误~~：expireTime 用于 JwtToken.setExpire(expireTime), 又用于 s3Request.presign(url, expireTime)

### 一致性
在同一个作用域中，命名方式要保持一致；
-  变量使用驼峰就全用驼峰；URL使用下划线，那所有的URL就都用下划线

- HttpServletResponse用response名称，其他HttpServletResponse也用response名称；
 
## 函数／方法

### 单一抽象层次原则

让一个函数中，所有操作处于相同的抽象层。函数中代码块的业务目标应该和函数名保持一致。

### 函数单一职责

一个函数只做一件事。如何确定只做一件事？看是否能再抽象出一个函数

### 函数名称
- 描述代码块所干的事情，能反映出业务内容
- 避免使用无意义，模糊，表达不清的动词， 如： do,run,perform,execute等
- 不要通过数字在区分不同子程序， 如 download1(), download2()
- 避免重复，如 Document类， Document.print 即可, 而Document.printDocument则啰嗦。而SystemUtil.printDocument则不是。

### 参数
- 不宜过长，否则考虑用数据结构代替


### 错误处理
- 考虑周全所有可能发生的错误，==不能偷懒==！除非你能100%保证业务上不会错。
- 缩小exception的范围，返回错误时可以追查到目标代码。

### 线程安全
- 在一些有可能会出现并发的情况下，使用线程安全的数据结构。比如concurrentHashMap替代HashMap；
- 防止死锁问题发生

## 注释
好的代码胜于好的注释。除非该函数极具特殊性，或着复杂程度已经无法用函数名来表达。

文档型注释必不可少。

## 日志
敏感数据如：用户账号、密码、个人信息等敏感数据==不允许==打印日志。比如用户的`SecretKey`。

请在以下地方添加你的日志：
- 方法入口：[日志级别][业务功能][参数]；

- 异常处理(仅限需要处理的异常):[日志级别][业务功能][参数][异常描述]；

- 外部接口调用开始: [日志级别][业务功能][调用接口名称][参数];

- 外部接口调用结束：[日志级别][业务功能][调用接口名称][调用结果][返回值];

- 方法出口: [日志级别][业务功能][返回值]；

## 测试代码

### 步骤
整体应分为三个环节:

- make: 构造测试数据；

- submit: 操作测试数据；

- assert: 检验是否得到期望的结果；

### 测试原则：

- 测试应该独立，可以单独运行一个测试不应成为下一个测试的条件；

- 测试边界条件，测试空值；

- 考虑所有场景是否覆盖完整；

## 文档
所谓磨刀不误砍柴功，好的文档可以更快的让别人明白你做的东西，并且==减少今后别人打搅你的时间！==

- 文档如果没有特殊要求，**请写markdown！**
- 如果是暴露给其他人的接口，请在文档中加入详细的API说明，包含至少以下markdown二级标题
    - 描述
    - 请求
    - 请求语法
    - 请求参数
    - 请求头
    - 请求元素
    - 响应
    - 响应头
    - 响应元素 
    - 特殊错误
    - 示例
    - 请求示例
    - 返回示例
    
- 如果涉及业务，请画出详细的UML流程图

## 代码设计原则

- 从整体想问题，方法是否正确，是否是最优解？是否可以减少内存使用？是否可以减少时间复杂度？

- 有没有自己没有考虑到的情况，每种边界，每种极端，每个异常；

- 可维护性：代码不能写死，代码容易修改，预测可能发生的变化；如果某天要修改的话，使修改的东西很少；引入常量、枚举。

- 尽量避免废弃代码的出现，即永远不会被调用到的，if,catch,util包，switch，case等中出现的；

- 删除没用的代码，而不是注释；

- 能否用多态代替if/else，switch/case;

- 在代码中做决定时，确认自己足够准确，如调用 `强制转换` 或者 `可能返回null的函数 ，确认自己检查了null值；确认没有空指针异常。

- 应该把解释了条件意图的函数抽离出来，如使用if(should(timer))代替if(timer.hasExpired() && timer.isRight());

- 封装边界条件，把边界有关的条件封装到一起，形成一个方法；
